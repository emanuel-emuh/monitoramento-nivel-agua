<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AquaMonitor Login</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg:#f5f7fb;--card:#fff;--text:#1b2430;--muted:#64748b;
      --primary:#1b5e20;--primary-600:#155a17;--danger:#d32f2f;--ring:#d5dde3;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background:var(--bg); color:var(--text); display:grid; place-items:center; padding:24px;
    }
    .card{
      width:min(420px,92vw); background:var(--card); border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(2,6,23,.08), 0 2px 8px rgba(2,6,23,.06);
      padding:28px 24px;
    }
    .brand{display:flex;gap:10px;align-items:center; margin-bottom:8px}
    .brand-logo{
      width:38px;height:38px;border-radius:50%;display:grid;place-items:center;
      background:#e8f5e9;color:var(--primary);font-weight:800
    }
    h1{font-size:22px;margin:0}
    .sub{margin:2px 0 18px;color:var(--muted);font-size:14px}

    .field{margin-bottom:14px}
    label{display:block;font-weight:600;margin-bottom:6px;font-size:14px}
    .input{
      width:100%;padding:12px 14px;border:1px solid var(--ring);border-radius:12px;
      background:#fff;color:var(--text);outline:none;transition:border .2s, box-shadow .2s
    }
    .input:focus{border-color:#9ccc9b; box-shadow:0 0 0 4px rgba(76,175,80,.12)}
    .pw-wrap{position:relative}
    .toggle{
      position:absolute;right:8px;top:50%;transform:translateY(-50%);
      background:#f1f5f9;border:1px solid var(--ring);border-radius:8px;
      padding:4px 8px;font-size:12px;cursor:pointer;
    }

    .error{min-height:20px;color:var(--danger);font-size:13px;margin:4px 0 8px}
    .actions{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:8px}
    .btn{
      appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer
    }
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .hint{color:var(--muted);font-size:12px}

    .footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <div class="brand">
      <div class="brand-logo">AM</div>
      <div>
        <h1 id="title">AquaMonitor Login</h1>
        <p class="sub">Acesse sua conta</p>
      </div>
    </div>

    <form id="form">
      <div class="field">
        <label for="email">E-mail</label>
        <input id="email" class="input" type="email" autocomplete="email" required placeholder="voce@exemplo.com" />
      </div>

      <div class="field">
        <label for="senha">Senha</label>
        <div class="pw-wrap">
          <input id="senha" class="input" type="password" autocomplete="current-password" required placeholder="••••••" />
          <button type="button" id="toggle" class="toggle" aria-label="Mostrar/ocultar senha">Mostrar</button>
        </div>
      </div>

      <div id="erro" class="error" aria-live="polite"></div>

      <div class="actions">
        <span class="hint">Use o e-mail e senha cadastrados.</span>
        <button type="submit" id="btn" class="btn btn-primary">Entrar</button>
      </div>
    </form>

    <div class="footer">© AquaMonitor</div>
  </main>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

  <script>
    // 1) Config do seu projeto
    const firebaseConfig = {
      apiKey: "AIzaSyBOBbMzkTO2MvIxExVO8vlCOUgpeZp0rSY",
      authDomain: "aqua-monitor-login.firebaseapp.com",
      databaseURL: "https://aqua-monitor-login-default-rtdb.firebaseio.com",
      projectId: "aqua-monitor-login"
    };
    firebase.initializeApp(firebaseConfig);

    // 2) Se já está logado, manda pro painel
    firebase.auth().onAuthStateChanged((user)=>{
      if (user) window.location.replace("admin.html");
    });

    // helpers
    const $ = (id)=>document.getElementById(id);
    const emailEl = $("email");
    const senhaEl = $("senha");
    const erroEl  = $("erro");
    const btnEl   = $("btn");

    // Lembra último email
    emailEl.value = localStorage.getItem("am:lastEmail") || "";

    // Mostrar/ocultar senha
    $("toggle").addEventListener("click", ()=>{
      const isPw = senhaEl.type === "password";
      senhaEl.type = isPw ? "text" : "password";
      $("toggle").textContent = isPw ? "Ocultar" : "Mostrar";
      senhaEl.focus();
    });

    // 3) Login
    $("form").addEventListener("submit", async (e)=>{
      e.preventDefault();
      erroEl.textContent = "";
      btnEl.disabled = true; btnEl.textContent = "Entrando...";

      const email = emailEl.value.trim();
      const senha = senhaEl.value;

      try{
        await firebase.auth().signInWithEmailAndPassword(email, senha);
        localStorage.setItem("am:lastEmail", email);
        // sucesso -> admin
        window.location.replace("admin.html");
      }catch(err){
        console.error(err);
        erroEl.textContent = traduz(err);
      }finally{
        btnEl.disabled = false; btnEl.textContent = "Entrar";
      }
    });

    function traduz(err){
      const code = err?.code || "";
      if (code.includes("wrong-password") || code.includes("user-not-found"))
        return "E-mail ou senha inválidos.";
      if (code.includes("too-many-requests"))
        return "Muitas tentativas. Aguarde um pouco e tente novamente.";
      if (code.includes("network"))
        return "Sem conexão. Verifique sua internet.";
      return "Não foi possível entrar. Tente novamente.";
    }
  </script>
</body>
</html>
