<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AquaMonitor - Dashboard</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="dashboard.css?v=9"/>

  <!-- Fonte (opcional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">
      <span class="logo-icon">AM</span>
      <h1>AquaMonitor</h1>
    </div>
    <a href="#" class="logout-button">Sair</a>
  </nav>

  <main class="container">
    <header style="text-align:center; margin: 18px 0 10px;">
      <h2>Monitoramento de N√≠vel</h2>
      <p>Consumo, status da bomba e controle em tempo real.</p>
    </header>

    <!-- ===== N√≠veis ===== -->
    <section aria-label="N√≠veis">
      <div class="card">
        <div class="card-icon icon-green">‚¨Ü</div>
        <h3>Caixa Principal</h3>
        <p id="main-level-value" class="value">--%</p>
        <p id="main-level-liters" class="subvalue">-- L</p>
        <div class="level-bar"><div id="level-fill-main" class="level-fill" style="width:0%"></div></div>
        <p>Percentual: <b id="level-percentage-main">--%</b></p>
        <div class="tank-visual">
          <div class="tank"><div id="client-water-main" class="water" style="height:0%"></div></div>
          <div class="tank-label"><span>Principal</span> (<span id="client-level-percent-main">--</span>%)</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon icon-green">‚¨á</div>
        <h3>Reservat√≥rio</h3>
        <p id="res-level-value" class="value">--%</p>
        <p id="res-level-liters" class="subvalue">-- L</p>
        <div class="level-bar"><div id="level-fill-res" class="level-fill" style="width:0%"></div></div>
        <p>Percentual: <b id="level-percentage-res">--%</b></p>
        <div class="tank-visual">
          <div class="tank"><div id="client-water-res" class="water" style="height:0%"></div></div>
          <div class="tank-label"><span>Reservat√≥rio</span> (<span id="client-level-percent-res">--</span>%)</div>
        </div>
      </div>
    </section>

    <!-- ===== Status e Controles ===== -->
    <section aria-label="Status e Controles">
      <div class="card">
        <div class="card-icon" id="pump-status-icon">‚öô</div>
        <h3>Status da Bomba</h3>
        <p class="value" id="pump-status-value">--</p>
        <p class="subvalue" id="pump-status-text">Aguardando...</p>
      </div>

      <div class="card">
        <div class="card-icon" id="mode-icon">üõ†</div>
        <h3>Modo de Opera√ß√£o</h3>
        <p class="value" id="mode-value">--</p>
        <p class="subvalue" id="mode-text">Aguardando...</p>
      </div>

      <div class="card settings-card">
        <h3>Controle da Bomba</h3>

        <!-- Switch Autom√°tico -->
        <div class="control-row">
          <label for="auto-mode-switch" style="font-weight:600;">Modo Autom√°tico</label>
          <input type="checkbox" id="auto-mode-switch" />
        </div>

        <!-- Bot√£o Manual -->
        <div class="control-row">
          <button id="motor-button" class="btn-motor-off">Ligar Bomba</button>
        </div>

        <p>Status atual: <b id="motor-status">--</b></p>
      </div>

      <!-- Modo Econ√¥mico (F√©rias) -->
      <div class="card settings-card" id="sec-modo-economico">
        <h3>Modo Econ√¥mico (F√©rias)</h3>
        <p class="settings-hint">
          Reduz o consumo: aplica limites <b>15%</b> (liga) e <b>50%</b> (desliga) enquanto ativo.
        </p>
        <div class="control-row">
          <button id="btn-ferias" class="normal" type="button">Ativar Modo F√©rias</button>
        </div>
        <p id="ferias-info" class="settings-info">
          <b>Modo F√©rias:</b> Usa limites de 15% a 50% para economizar.
        </p>
      </div>
    </section>

    <!-- ===== Consumo / Gr√°fico + Exporta√ß√£o ===== -->
    <section aria-label="Consumo">
      <div class="card">
        <div class="card-icon">üìà</div>
        <h3>Consumo Estimado</h3>
        <p id="consumption-value" class="value">-- L/dia</p>
        <p id="consumption-text" class="subvalue">Calculando...</p>

       <!-- Controles de exporta√ß√£o CSV (substitua o bloco antigo por este) -->
<div class="export-row" style="display:flex; gap:10px; align-items:center; margin-top:8px; flex-wrap:wrap;">
  <label for="export-range" style="font-weight:600;">Exportar hist√≥rico:</label>
  <select id="export-range" aria-label="Per√≠odo" style="padding:8px 10px; border-radius:8px; border:1px solid #d5dde3;">
    <option value="7">√öltimos 7 dias</option>
    <option value="30">√öltimos 30 dias</option>
  </select>

  <label for="export-format" style="font-weight:600;">Formato:</label>
  <select id="export-format" aria-label="Formato" style="padding:8px 10px; border-radius:8px; border:1px solid #d5dde3;">
    <option value="simple" selected>Simples (Data; Hora; Caixa%; Reservat√≥rio%)</option>
    <option value="full">Completo (+ timestamp_ms)</option>
  </select>

  <label for="export-sep" style="font-weight:600;">Separador:</label>
  <select id="export-sep" aria-label="Separador" style="padding:8px 10px; border-radius:8px; border:1px solid #d5dde3;">
    <option value=";" selected>Ponto e v√≠rgula (;)</option>
    <option value=",">V√≠rgula (,)</option>
  </select>

  <button id="btn-export-csv" class="btn-export" type="button">Exportar CSV</button>
  <small id="export-hint" class="subvalue">CSV pronto para Excel/Sheets.</small>
</div>

        <div style="height:260px; margin-top: 12px;">
          <canvas id="levelChart"></canvas>
        </div>
      </div>
    </section>
  </main>

  <footer style="text-align:center; padding: 24px 0; color:#777;">
    <small>&copy; 2025 AquaMonitor</small>
  </footer>

  <!-- Firebase compat -->
  <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <!-- Chart.js (opcional) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- App -->
  <script defer src="dashboard.js?v=12"></script>
</body>
</html>

